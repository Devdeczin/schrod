# ====================================================================================
# Schrod Kernel – Nim configuration (freestanding / i386) – Adaptado para Nim 1.4.8
# ====================================================================================
# Este arquivo define APENAS o que pode ser confiavelmente definido via nim.cfg.
# Flags sensíveis (compileOnly, app, noMain forte) devem ser reforçadas via CLI.
# ====================================================================================

# --------------------------------------------------------------------
# Target
# --------------------------------------------------------------------
--cpu:i386
--os:standalone

# --------------------------------------------------------------------
# Kernel / freestanding mode
# --------------------------------------------------------------------
-d:nimNoSystem
-d:nimNoMain
-d:danger
# -d:nimEmulateOverflowChecks  # removido, não existe no 1.4.8

# --------------------------------------------------------------------
# Memory / runtime
# --------------------------------------------------------------------
#--mm:none
--gc:none
--exceptions:goto
--panics:off
--threads:off

# --------------------------------------------------------------------
# Debug / tracing (OFF)
# --------------------------------------------------------------------
--stacktrace:off
--lineTrace:off
--assertions:off
--checks:off
--overflowChecks:off
--nilChecks:off
--hints:off
--warnings:off

# --------------------------------------------------------------------
# Optimization
# --------------------------------------------------------------------
--opt:speed

# --------------------------------------------------------------------
# Nim cache (LOCAL, CONTROLADO)
# --------------------------------------------------------------------
--nimcache:"./build/nimcache"

# --------------------------------------------------------------------
# C compiler flags (freestanding kernel)
# --------------------------------------------------------------------
--passC:"-ffreestanding"
--passC:"-fno-stack-protector"
--passC:"-fno-builtin"
--passC:"-m32"

# --------------------------------------------------------------------
# Linker flags
# --------------------------------------------------------------------
--passL:"-nostdlib"
--passL:"-m32"

# ====================================================================================
# IMPORTANTE:
#
# * NÃO confiar que nim.cfg aplica:
#     --compileOnly
#     --app:staticlib
#
# Essas devem ser passadas SEMPRE na linha de comando.
#
# Exemplo correto:
#   nim c --noMain --compileOnly --app:staticlib kmain.nim
# ====================================================================================